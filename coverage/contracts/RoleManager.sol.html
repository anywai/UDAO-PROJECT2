<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/RoleManager.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> RoleManager.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">59.46% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>22/37</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">38.89% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>14/36</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">61.54% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>8/13</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">62.79% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>27/43</span>
      </div>
    </div>
  </div>
  <div class='status-line medium'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">213×</span>
<span class="cline-any cline-yes">213×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">142×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">142×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">142×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">117×</span>
<span class="cline-any cline-yes">117×</span>
<span class="cline-any cline-yes">117×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">117×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7100×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7100×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7100×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7100×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">120×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">120×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">117×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">117×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
/// @title Interface of role manager: UDAO smart contract's role, KYC and ban management
pragma solidity ^0.8.4;
&nbsp;
import "@openzeppelin/contracts/access/AccessControl.sol";
&nbsp;
import "./interfaces/ISupervision.sol";
import "./RoleNames.sol";
&nbsp;
contract RoleManager is AccessControl, RoleNames {
    /// @notice Supervision contract is manages juror and validator based actions
    ISupervision supervision;
&nbsp;
    ///@dev functionId =&gt; if KYC check Active or not
    mapping(uint256 =&gt; bool) public activeKYCFunctions;
    ///@dev functionId =&gt; if Ban check Active or not
    mapping(uint256 =&gt; bool) public activeBanFunctions;
&nbsp;
    /// @dev This event is triggered if the supervision contract address is updated.
    event AddressesUpdated(address SupervisionAddress);
&nbsp;
    mapping(address =&gt; bool) KYCList;
    mapping(address =&gt; bool) BanList;
&nbsp;
    /// @notice events fired when a KYC or Ban is set
    event SetKYC(address indexed user, bool indexed result);
    event SetBan(address indexed user, bool indexed result);
&nbsp;
    /// @notice Deployer gets the admin role.
    constructor() {
        _grantRole(DEFAULT_ADMIN_ROLE, msg.sender);
        _grantRole(ROLEMANAGER_CONTRACT, address(this));
    }
&nbsp;
    /// @notice Get the updated addresses from contract manager
    /// @param supervisionAddress The address of the supervision contract
    function updateAddresses(address supervisionAddress) external {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(
            (hasRole(BACKEND_ROLE, msg.sender) ||
<span class="branch-1 cbranch-no" title="branch not covered" >                hasRole(CONTRACT_MANAGER, msg.sender)</span>),
            "Only backend can update addresses"
        );
        supervision = ISupervision(supervisionAddress);
&nbsp;
        emit AddressesUpdated(supervisionAddress);
    }
&nbsp;
    /// @notice Modified AccessControl checkRoles for multiple role check
    /// @param roles The name of the roles to check
<span class="fstat-no" title="function not covered" >    function hasRoles(</span>
        bytes32[] memory roles,
        address account
    ) public view returns (bool) {
<span class="cstat-no" title="statement not covered" >        uint rolesLength = roles.length;</span>
<span class="cstat-no" title="statement not covered" >        for (uint i = 0; i &lt; rolesLength; i++) {</span>
<span class="cstat-no" title="statement not covered" >            if (hasRole(roles[i], account)) {</span>
<span class="cstat-no" title="statement not covered" >                return true;</span>
            }
        }
<span class="cstat-no" title="statement not covered" >        return false;</span>
    }
&nbsp;
    /// @notice set KYC for an account address
    /// @param _address address that will be KYCed
    /// @param _isKYCed result of KYC
    function setKYC(address _address, bool _isKYCed) external {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(hasRole(BACKEND_ROLE, msg.sender), "Only backend can set KYC");
        KYCList[_address] = _isKYCed;
        emit SetKYC(_address, _isKYCed);
&nbsp;
        if (!_isKYCed) {
            supervision.dismissValidation(_address);
            supervision.dismissDispute(_address);
        }
    }
&nbsp;
    /// @notice set ban for an account address
    /// @param _address address that will be ban set
    /// @param _isBanned ban set result
    function setBan(address _address, bool _isBanned) external {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(
            hasRole(BACKEND_ROLE, msg.sender) ||
<span class="branch-1 cbranch-no" title="branch not covered" >                hasRole(SUPERVISION_CONTRACT, msg.sender)</span>,
            "Only backend or supervision contract can set ban"
        );
        <span class="missing-if-branch" title="else path not taken" >E</span>require(!hasRole(BACKEND_ROLE, _address), "Backend cannot be banned");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(
            !hasRole(FOUNDATION_ROLE, _address),
            "Foundation cannot be banned"
        );
&nbsp;
        BanList[_address] = _isBanned;
        emit SetBan(_address, _isBanned);
&nbsp;
        <span class="missing-if-branch" title="else path not taken" >E</span>if (_isBanned) {
            supervision.dismissValidation(_address);
            supervision.dismissDispute(_address);
        }
    }
&nbsp;
    /// @notice Setter function of activeKYCFunctions
    /// @param functionId function id of the function
    /// @param status KYC status of the function
    function setActiveKYCFunctions(uint256 functionId, bool status) external {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(
            hasRole(BACKEND_ROLE, msg.sender),
            "Only backend can set activeKYCFunctions"
        );
        activeKYCFunctions[functionId] = status;
    }
&nbsp;
    /// @notice Setter function of activeBanFunctions
    /// @param functionId function id of the function
    /// @param status Ban status of the function
    function setActiveBanFunctions(uint256 functionId, bool status) external {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(
            hasRole(BACKEND_ROLE, msg.sender),
            "Only backend can set activeBanFunctions"
        );
        activeBanFunctions[functionId] = status;
    }
&nbsp;
    /// @notice gets KYC result of the address if KYC is active for the function else returns true
    /// @param _address wallet that KYC result will be sent
    function isKYCed(
        address _address,
        uint256 functionId
    ) external view returns (bool) {
        <span class="missing-if-branch" title="if path not taken" >I</span>if (activeKYCFunctions[functionId] == false) {
<span class="cstat-no" title="statement not covered" >            return true;</span>
        } else {
            return KYCList[_address];
        }
    }
&nbsp;
    /// @notice gets ban result of the address if ban is active for the function else returns false
    /// @param _address wallet that ban result will be sent
    function isBanned(
        address _address,
        uint256 functionId
    ) external view returns (bool) {
        <span class="missing-if-branch" title="if path not taken" >I</span>if (activeBanFunctions[functionId] == false) {
<span class="cstat-no" title="statement not covered" >            return false;</span>
        } else {
            return BanList[_address];
        }
    }
&nbsp;
    /// @notice grants a role to an account
    /// @param role The name of the role to grant
    /// @param user The address of the account to grant the role to
<span class="fstat-no" title="function not covered" >    function grantRoleStaker(bytes32 role, address user) external {</span>
<span class="cstat-no" title="statement not covered" >        require(</span>
            hasRole(STAKING_CONTRACT, msg.sender),
            "Only staking contract can grant roles"
        );
<span class="cstat-no" title="statement not covered" >        _grantRole(role, user)</span>;
    }
&nbsp;
    /// @notice revokes a role from an account
    /// @param role The name of the role to revoke
    /// @param user The address of the account to revoke the role from
<span class="fstat-no" title="function not covered" >    function revokeRoleStaker(bytes32 role, address user) external {</span>
<span class="cstat-no" title="statement not covered" >        require(</span>
            hasRole(STAKING_CONTRACT, msg.sender),
            "Only staking contract can revoke roles"
        );
<span class="cstat-no" title="statement not covered" >        _revokeRole(role, user)</span>;
    }
&nbsp;
    /// @notice grants BACKEND_ROLE to a new address
    /// @param backendAddress The address of the backend to grant
<span class="fstat-no" title="function not covered" >    function grantBackend(address backendAddress) external {</span>
<span class="cstat-no" title="statement not covered" >        require(</span>
            hasRole(FOUNDATION_ROLE, msg.sender),
            "Only foundation can grant backend"
        );
<span class="cstat-no" title="statement not covered" >        _grantRole(BACKEND_ROLE, backendAddress)</span>;
    }
&nbsp;
    /// @notice revokes BACKEND_ROLE and bans the backend address
    /// @param backendAddress The address of the backend to revoke
<span class="fstat-no" title="function not covered" >    function revokeBackend(address backendAddress) external {</span>
<span class="cstat-no" title="statement not covered" >        require(</span>
            hasRole(FOUNDATION_ROLE, msg.sender),
            "Only foundation can revoke backend"
        );
<span class="cstat-no" title="statement not covered" >        _revokeRole(BACKEND_ROLE, backendAddress)</span>;
        BanList[backendAddress] = true;
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Wed Nov 15 2023 10:12:08 GMT+0300 (GMT+03:00)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
